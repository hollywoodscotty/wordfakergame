<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Word Faker Game</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #111;
  color: #eee;
  display: flex;
  align-items: center;
  justify-content: center;
  height: 100vh;
  margin: 0;
  text-align: center;
}
.card {
  background: #1e1e1e;
  padding: 6vh 6vw;
  border-radius: 24px;
  box-shadow: 0 20px 50px rgba(0,0,0,0.6);
  width: 90vw;
  height: 90vh;
  overflow-y: auto;
}
h1 { font-size: clamp(4rem,7vw,7rem); }
h2 { font-size: clamp(2.5rem,5vw,5rem); }
p, ul  { font-size: clamp(1.6rem,3vw,3rem); }

.list {
  text-align: center;
  text-wrap: wrap;
  width: 50%;
  margin-left: auto;
  margin-right: auto;
}

ul {text-align: left;}

input {
  font-size: 2.5rem;
  padding: 1vh 1vw;
  border-radius: 12px;
  border: none;
  width: 50%;
  text-align: center;
}

button {
  font-size: 2.5rem;
  padding: 1vh 3vw;
  margin-top: 3vh;
  border-radius: 16px;
  border: none;
  background: #4caf50;
  cursor: pointer;
}

.countdown {
  font-size: clamp(5rem,10vw,10rem);
  letter-spacing: 0.2em;
  font-weight: 100;
}

.value {
  font-size: clamp(5rem,10vw,10rem);
  letter-spacing: 0.2em;
  color: #FF7777;
}

.player-bar {
  display: flex;
  justify-content: center;
  gap: 2vw;
  margin-bottom: 3vh;
  flex-wrap: wrap;
}

.player {
  font-size: 2.5rem;
  opacity: 0.6;
}

.player.active {
  font-size: 4rem;
  opacity: 1;
}

.score-row {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 2vw;
  margin: 2vh 0;
  font-size: 2.5rem;
}

.faker-reveal {
  font-size: clamp(4rem,8vw,9rem);
  margin: 3vh 0;
}
</style>
</head>

<body>
<div class="card" id="app"></div>

<script>
const WORD_BANK = [
"APPLE","BANANA","ORANGE","HOUSE","CAR","TRAIN","PLANE","BOAT","RIVER",
"OCEAN","BEACH","MOUNTAIN","FOREST","DESERT","CLOUD","RAIN","SNOW",
"THUNDER","LIGHTNING","FIRE","SMOKE","STONE","ROCK","SAND","CHAIR",
"TABLE","COUCH","BED","PILLOW","BLANKET","CLOCK","WATCH","PHONE",
"COMPUTER","SCREEN","KEYBOARD","MOUSE","CAMERA","LIGHT","LAMP","DOOR",
"WINDOW","FLOOR","CEILING","WALL","STAIRS","BRIDGE","ROAD","STREET",
"CITY","TOWN","VILLAGE","SCHOOL","CLASS","TEACHER","STUDENT","BOOK",
"PAPER","PENCIL","PEN","ERASER","BAG","BACKPACK","SHOES","HAT","COAT",
"SHIRT","PANTS","FOOD","BREAD","CHEESE","MILK","WATER","COFFEE","TEA",
"SUGAR","SALT","PEPPER","CAKE","COOKIE","ICE","CANDLE","MIRROR",
"MUSIC","SONG","MOVIE","GAME","BALL","TOY","GIFT"
];

const EMOJI_BANK = [
"ðŸ¶","ðŸ±","ðŸ­","ðŸ¹","ðŸ°","ðŸ¦Š","ðŸ»","ðŸ¼","ðŸ¨","ðŸ¯",
"ðŸ¦","ðŸ®","ðŸ·","ðŸ¸","ðŸµ","ðŸ”","ðŸ§","ðŸ¦","ðŸ¤","ðŸ¦†",
"ðŸ¦‰","ðŸ¦‡","ðŸº","ðŸ—","ðŸ´","ðŸ¦„","ðŸ","ðŸ¦‹","ðŸŒ","ðŸ¢"
];

const app = document.getElementById("app");

let audioCtx;
let players = 4;
let currentPlayer = 1;
let oddPlayer = 1;
let secretWord = "";
let emojis = [];
let points = [];

let countdownInterval, countdownCallback;

function melissaBad() {
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    // Create oscillator for the low rumble
    const oscillator = audioCtx.createOscillator();
    oscillator.type = 'square'; // softer, rumblier than square
    oscillator.frequency.setValueAtTime(30, audioCtx.currentTime); // low, grumbly

    // Add some distortion/noise using Gain modulation
    const gainNode = audioCtx.createGain();
    gainNode.gain.setValueAtTime(0.4, audioCtx.currentTime);

    // Create a low-frequency oscillator to wobble the main frequency
    const lfo = audioCtx.createOscillator();
    lfo.type = 'sine';
    lfo.frequency.setValueAtTime(30, audioCtx.currentTime); // wobble speed

    const lfoGain = audioCtx.createGain();
    lfoGain.gain.setValueAtTime(20, audioCtx.currentTime); // how much it wobbles

    // Connect LFO to main oscillator frequency
    lfo.connect(lfoGain);
    lfoGain.connect(oscillator.frequency);

    // Connect main oscillator to gain, then to speakers
    oscillator.connect(gainNode);
    gainNode.connect(audioCtx.destination);

    // Start both oscillators
    oscillator.start();
    lfo.start();

    // Stop after 0.8 seconds
    oscillator.stop(audioCtx.currentTime + 0.8);
    lfo.stop(audioCtx.currentTime + 0.8);
}

function blip(input){
  if(!audioCtx) return;

  const DEFAULT_FREQ = 800;
  const DEFAULT_DURATION = 0.12;
  const DEFAULT_GAP = 0.12;
  const GAIN = 0.12;

  let pattern;

  // Normalize input
  if (Array.isArray(input)) {
    // Nested arrays â†’ [[freq,dur,gap], ...]
    if (Array.isArray(input[0])) {
      pattern = input.map(v => ({
        freq: v[0] ?? DEFAULT_FREQ,
        duration: v[1] ?? DEFAULT_DURATION,
        gap: v[2] ?? DEFAULT_GAP
      }));
    }
    // Flat array â†’ [freq,freq,freq]
    else {
      pattern = input.map(v => ({
        freq: v ?? DEFAULT_FREQ,
        duration: DEFAULT_DURATION,
        gap: DEFAULT_GAP
      }));
    }
  }
  // Single number
  else {
    pattern = [{
      freq: input ?? DEFAULT_FREQ,
      duration: DEFAULT_DURATION,
      gap: DEFAULT_GAP
    }];
  }

  let t = audioCtx.currentTime;

  pattern.forEach(p => {
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();

    o.frequency.value = p.freq;
    g.gain.value = GAIN;

    o.connect(g);
    g.connect(audioCtx.destination);

    o.start(t);
    o.stop(t + p.duration);

    t += p.duration + p.gap;
  });
}

function shufflePlayers(){
  for(let i = emojis.length - 1; i > 0; i--){
    const j = Math.floor(Math.random() * (i + 1));
    [emojis[i], emojis[j]] = [emojis[j], emojis[i]];
    [points[i], points[j]] = [points[j], points[i]];
  }
}

function renderBar(active=true){
  return `
  <div class="player-bar">
    ${emojis.map((e,i)=>`
      <div class="player ${active && i+1===currentPlayer?"active":""}">
        ${e} (${points[i]})
      </div>`).join("")}
  </div>`;
}

/* NEW: "Player #'s Turn!" screen */
function turnScreen(){
  blip(400);
  countdown(
    `${renderBar()}<h2>${emojis[currentPlayer-1]}Player ${currentPlayer},<br><h2><h1>Your turn!</h1>`, 
    5, 
    readyScreen
  );
}

function startScreen(){
  app.innerHTML = `
    <h1>Word Faker Game</h1>
    <p>
      Each player gets a turn to secretly view a word while the others look away.
      All players see the same wordâ€¦ except one.
      That player sees only question marks and is known as <strong>The Faker</strong>.
      <br><br>
      When itâ€™s time to play, each player says a different word related to the secret word.
      The group must figure out who The Faker is.
    </p>
    <p>How many players?</p>
    <input id="pcount" placeholder="4">
    <button onclick="startGame()">Start</button>`;
}

function startGame(){
  audioCtx = new (window.AudioContext||window.webkitAudioContext)();
  players = parseInt(document.getElementById("pcount").value)||4;
  points = Array(players).fill(0);
  emojis = [...EMOJI_BANK].sort(()=>Math.random()-0.5).slice(0,players);
  startRound();
}

function startRound(){
  shufflePlayers();
  secretWord = WORD_BANK[Math.floor(Math.random()*WORD_BANK.length)];
  oddPlayer = Math.floor(Math.random()*players)+1;
  currentPlayer = 1;
  turnScreen();
}

function readyScreen(){
  blip(600);
  countdown(
    `${renderBar()}<h2>${emojis[currentPlayer-1]}Player ${currentPlayer},<br><h2><h1>Ready?</h1>`,
    5,
    wordScreen
  );
}

function wordScreen(){
  blip(800);
  const v = currentPlayer===oddPlayer?"???":secretWord;
  countdown(
    `${renderBar()}<h2>${emojis[currentPlayer-1]}Player ${currentPlayer}, your word is:<br><h2><span class="value">${v}</span>`,
    5,
    nextPlayer
  );
}

function nextPlayer(){
  if(currentPlayer<players){
    currentPlayer++;
    turnScreen();
  } else {
    playScreen();
  }
}

function playScreen(){
  blip(1000);
  app.innerHTML = `
    ${renderBar(false)}
    <h1>Now PLAY!</h1>
    <button onclick="reveal()">Reveal</button>`;
}

function reveal(){
  blip(800);
  countdown(
    `${renderBar(false)}
     <h1>Reveal</h1>
     <div class="faker-reveal">
       ${emojis[oddPlayer-1]}Player ${oddPlayer}
     </div>
     <p>was The Faker</p>`,
    5,
    fakerGuess
  );
}

function fakerGuess(){
  blip(800);
  countdown(
    `${renderBar(false)}
     <h1>Faker ${emojis[oddPlayer-1]}Player ${oddPlayer},</h1>
     <p>Guess the word out loud.</p>`,
    30,
    scoreScreen
  );
}

function scoreScreen(){
  blip([
    [800,0.1,0],
    [1000,0.1,0],
    [1200,0.1,0],
    [1000,0.1,0],
    [800]
  ]);
  app.innerHTML = `
    <h1>Adjust Scores</h1><br>
    <div class="list">
      <ul>
        <li>The players who guessed The Faker get <b>1 point</b>.<br></li>
        <li>If The Faker fooled more than half of the players, The Faker gets <b>1 point</b>.<br></li>
        <li>If The Faker guessed the word in the end, The Faker gets <b>1 more point</b>.</li>
      </ul>
    </div>
    ${emojis.map((e,i)=>`
      <div class="score-row">
        Player ${i+1} ${e} (${points[i]})
        <button onclick="points[${i}]++;scoreScreen()">+</button>
        <button onclick="points[${i}]--;scoreScreen()">-</button>
      </div>`).join("")}
    <button onclick="startRound()">Next Round</button><br><button onclick="melissaBad()">Melissa's Words Were Bad</button>`;
}

function countdown(content,secs,cb){
  clearInterval(countdownInterval);
  countdownCallback=cb;
  let r=secs;
  app.innerHTML = `${content}<div class="countdown">${r}</div><button onclick="skip()">Skip</button>`;
  countdownInterval=setInterval(()=>{
    blip(1200);
    r--;
    document.querySelector(".countdown").textContent=r;
    if(r<=0){clearInterval(countdownInterval);cb();}
  },1000);
}

function skip(){
  clearInterval(countdownInterval);
  countdownCallback();
}

startScreen();
</script>
</body>
</html>
